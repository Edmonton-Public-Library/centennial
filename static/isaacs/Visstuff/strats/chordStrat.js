var addToOldValue = function (newValue, oldValue) {
	if(isNaN(oldValue)) {
		return newValue ? newValue : 0;
	}
	return oldValue + (newValue ? newValue : 0);
}

var nanIsZero = function (newValue, oldValue) {
	return (isNaN(oldValue)) ? 0 : oldValue;
}

var countNotZero = function(obj) {
	return (obj.count > 0);
}

var chordStrat = new Object();
chordStrat.getStrat = function(){
	return [
		{
			"from":"returnValue",
			"to":"",
			"map":[
				{
					"from":"values",
					"to":"tempValues",
					"condition":countNotZero,
					"iterate":[
						{
							"from":"",
							"to":"",
							"filter":"author",
							"map":[
								{
									"from":"author1",
									"to":"author1"
								},
								{
									"from":"author2",
									"to":"author2"
								}
							]
						},
						{
							"from":"activitiesType",
							"to":"type",
							"filter":"type"
						},
						{
							"from":"count",
							"to":"count"
						}
					]
				},
				{
					"remap":1,
					"from":"tempValues",
					"to":"",
					"map":[
						{
							"from":"",
							"to":"slices",
							"unique":[
								{
									"from":"author1",
									"to":"title"
								}
							],
							"iterate":[
								{
									"from":"count",
									"to":"sent",
									"appendFunction":addToOldValue
								},
								{
									"from":"author1",
									"index":"people"
								}
							]
						},
						{
							"from":"",
							"to":"slices",
							"unique":[
								{
									"from":"author2",
									"to":"title"
								}
							],
							"iterate":[
								{
									"from":"count",
									"to":"received",
									"appendFunction":addToOldValue
								},
								{
									"from":"author2",
									"index":"people"
								}
							]
						},
						{
							"to":"slices",
							"iterate":[
								{
									"from":"sent",
									"to":"sent",
									"appendFunction":nanIsZero //if sent hasn't been set, set it to zero
								},
								{
									"from":"received",
									"to":"received",
									"appendFunction":nanIsZero //if received hasn't been set, set it to zero
								},
								{
									"from":"title",
									"to":"colour",
									"toList":d3.scale.getcategory60(),
									"tag":"author",
									"legend":"author",
									"toType":"colour"
								}
							]
						},
						{
							"from":"",
							"to":"chords",
							"unique":[
								{
									"from":"author1",
									"to":"source",
									"index":"people"
								},
								{
									"from":"author2",
									"to":"target",
									"index":"people"
								}
							],
							"iterate":[
								{
									"from":"count",
									"to":"width",
									"appendFunction":addToOldValue
								},
								/*{
									"from":"",
									"to":"subChords",
									"unique":[
										{
											"from":"type",
											"to":"colour",
											"toList":["#ff0000", "#00ff00", "#0000ff"],
											"tag":"Activities",
											"legend":"Activities",
											"toType":"colour"
										}
									],
									"iterate":[
										{
											"from":"count",
											"to":"width",
											"appendFunction":addToOldValue
										}
									]
								}*/
							]
						},
						{
							"from":"",
							"to":"totals",
							"unique":1,
							"iterate":[
								{
									"from":"count",
									"to":"totalMessages",
									"appendFunction":addToOldValue
								}
							]
						}
					]
				}
			]
		}
	];
}